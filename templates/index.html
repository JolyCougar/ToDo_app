<!DOCTYPE html>
{% load static i18n %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To Do App</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" type="text/css" media="all">
</head>
<style>
    .header-info {
        display: flex;
        align-items: center;
    }

    .user-profile {
        display: flex;
        align-items: center;
        text-decoration: none;
        color: var(--gray-dark);
        margin-right: 20px;
    }

    .user-avatar {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        margin-right: 5px;
    }

    .task-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: var(--border-radius);
        background-color: var(--gray-light);
        box-shadow: var(--box-shadow);
        transition: background-color 0.3s;
    }

    .task-item input[type="checkbox"] {
        margin-right: 5px;
        cursor: pointer;
    }

</style>
<body>
<div class="container">
    <header>
        <div class="header-info">
            <a href="{% url 'my_auth:profile' pk=user.pk %}" class="user-profile">
                <div class="avatar-container">

                    {% if user.profile.avatar %}
                        <img src="{{ user.profile.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä" id="userAvatar"
                             class="user-avatar">
                    {% else %}
                        <img src="{% static 'images/default_avatar.png' %}" alt="–ê–≤–∞—Ç–∞—Ä" id="userAvatar"
                             class="user-avatar">
                    {% endif %}
                </div>
                <span id="username">{{ user.username }}</span>
            </a>
            <span id="dateDisplay"></span>
            <span id="taskCount" style="margin-left: 20px;">{% trans "–ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:" %} <span
                    id="incompleteCount">0</span></span>
            <form method="post" action="{% url 'my_auth:logout' %}" class="logout-form">
                {% csrf_token %}
                <button type="submit" class="small-button">{% trans "–í—ã–π—Ç–∏" %}</button>
            </form>
        </div>

        <div class="header-buttons">
            <button class="settings" id="settingsBtn">{% trans "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" %}</button>
            <button class="large-button" id="addTaskButton">{% trans "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É" %}</button>
        </div>
    </header>


    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
    <div id="modal" class="modal" style="display: none;">
        <div class="modal-content_task">
            <span class="close" id="closeModal">&times;</span>
            <h2>{% trans "–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É" %}</h2>
            <form id="taskForm" novalidate>
                {% csrf_token %}
                <input type="text" id="taskInput" placeholder="{% trans "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" %}" required>
                <textarea id="taskDescription" placeholder="{% trans "–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" %}"></textarea>
                <button id="confirmAddTask" type="submit">{% trans "–î–æ–±–∞–≤–∏—Ç—å" %}</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settingsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" id="closeSettingsModal">&times;</span>
            <h2>{% trans "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" %}</h2>
            <form id="settingsForm" novalidate>

                <div class="form-group">
                    <label for="languageSelect">{% trans "–Ø–∑—ã–∫:" %}</label>
                    <select id="languageSelect">
                        <option value="en"
                                {% if request.session.django_language == 'en' %}selected{% endif %}>{% trans "English" %}
                        </option>
                        <option value="ru"
                                {% if request.session.django_language == 'ru' %}selected{% endif %}>{% trans "–†—É—Å—Å–∫–∏–π" %}
                        </option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="fontSelect">{% trans "–®—Ä–∏—Ñ—Ç:" %}</label>
                    <select id="fontSelect">
                        <option value="Arial">Arial</option>
                        <option value="Courier New">Courier New</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Verdana">Verdana</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="fontSizeSelect">{% trans "–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞:" %}</label>
                    <select id="fontSizeSelect">
                        <option value="14">14px</option>
                        <option value="16" selected>16px</option>
                        <option value="18">18px</option>
                        <option value="20">20px</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="showCompletedTasks" checked>
                        {% trans "–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏" %}
                    </label>
                </div>

                <div class="form-group">
                    <label for="backgroundSelect">{% trans "–§–æ–Ω" %}:</label>
                    <select id="backgroundSelect">
                        <option value="default">{% trans "–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é" %}</option>
                        <option value="background1">{% trans "–§–æ–Ω 1" %}</option>
                        <option value="background2">{% trans "–§–æ–Ω 2" %}</option>
                        <option value="background3">{% trans "–§–æ–Ω 3" %}</option>
                        <option value="custom">{% trans "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ñ–æ–Ω" %}</option>
                    </select>
                </div>
                <div class="form-group" id="customBackgroundGroup" style="display: none;">
                    <label for="customBackgroundInput"
                           class="file-input-label">{% trans "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ–π —Ñ–æ–Ω" %}:</label>
                    <input type="file" id="customBackgroundInput" accept="image/*" class="file-input">
                </div>
                <div class="form-group">
                    <label for="deleteFrequencySelect">{% trans "–ß–∞—Å—Ç–æ—Ç–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á" %}:</label>
                    <select id="deleteFrequencySelect">
                        <option value="never">{% trans "–ù–∏–∫–æ–≥–¥–∞" %}</option>
                        <option value="minute">{% trans "–†–∞–∑ –≤ –º–∏–Ω—É—Ç—É" %}</option>
                        <option value="hour">{% trans "–†–∞–∑ –≤ —á–∞—Å" %}</option>
                        <option value="day">{% trans "–†–∞–∑ –≤ –¥–µ–Ω—å" %}</option>
                        <option value="week">{% trans "–†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é" %}</option>
                        <option value="month">{% trans "–†–∞–∑ –≤ –º–µ—Å—è—Ü" %}</option>
                    </select>
                </div>

                <button type="submit" id="saveSettingsButton">{% trans "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏" %}</button>
            </form>
        </div>
    </div>


    <main>
        <section>
            <h2>{% trans "–ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏" %}</h2>
            <ul class="task-list" id="taskList">
                {% for task in task_list %}
                    {% if not task.complete %}
                        <li class="task-item" data-task-id="{{ task.id }}">
                            <input type="checkbox" id="task{{ task.id }}">
                            <label for="task{{ task.id }}">{{ task.name }}</label>
                            <span class="task-details">
                                <span>{{ task.description }}</span>
                            </span>
                            <button class="delete-task" aria-label="{% trans "–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É" %}">üóëÔ∏è</button>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </section>

        <section>
            <h2>
                {% trans "–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏" %}
                <button id="toggleCompletedList"
                        aria-label="{% trans "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á" %}">{% trans "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å" %}</button>
            </h2>
            <ul class="completed-list" id="completedList">
                {% for task in task_list %}
                    {% if task.complete %}
                        <li class="completed-item" data-task-id="{{ task.id }}">
                            <span class="completed-label">{{ task.name }}</span>
                            <span class="completed-label">{{ task.description }}</span>
                            <button class="delete-task" aria-label="{% trans "–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É" %}">üóëÔ∏è</button>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </section>
    </main>
</div>

<!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ cookies -->
{% if not user.profile.cookies_accepted %}
    <div class="cookie-banner" id="cookieBanner">
        <p>{% trans "–≠—Ç–æ—Ç —Å–∞–π—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç cookies –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞." %}
            <button id="acceptCookiesButton">{% trans "–ü—Ä–∏–Ω—è—Ç—å" %}</button>
        </p>
    </div>
{% endif %}



<script src="{% static 'js/scripts.js' %}"></script>

<script>

    document.getElementById('settingsForm').addEventListener('submit', function (event) {
        event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã

        const deleteFrequency = document.getElementById('deleteFrequencySelect').value;

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç–æ—Ç—É —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        fetch('/update-profile/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken'), // –ü–æ–ª—É—á–∏—Ç–µ CSRF-—Ç–æ–∫–µ–Ω
            },
            body: JSON.stringify({
                delete_frequency: deleteFrequency
            })
        })
            .then(response => {
                if (response.ok) {

                    document.getElementById('settingsModal').style.display = 'none'; // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                } else {
                    console.error('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —á–∞—Å—Ç–æ—Ç—ã —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á.');
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
            });
    });

    document.getElementById('languageSelect').addEventListener('change', function () {
        const selectedLanguage = this.value;
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞
        fetch(`/set_language/${selectedLanguage}/`, {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            },
        }).then(response => {
            if (response.ok) {
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —è–∑—ã–∫–∞
                location.reload();
            } else {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —è–∑—ã–∫–∞');
            }
        }).catch(error => {
            console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
        });
    });
    
   const translations = {
    ru: {
        collapse: '–°–≤–µ—Ä–Ω—É—Ç—å',
        expand: '–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å'
    },
    en: {
        collapse: 'Collapse',
        expand: 'Expand'
    }
};

// –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π —è–∑—ã–∫ –∏–∑ —Å–µ—Å—Å–∏–∏
const currentLanguage = '{{ current_language|default:"ru" }}';
window.currentLanguage = currentLanguage; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
window.translations = translations; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —è–∑—ã–∫–∞ –≤ –ø–µ—Ä–µ–≤–æ–¥–∞—Ö
if (!translations[currentLanguage]) {
    console.error(`–Ø–∑—ã–∫ "${currentLanguage}" –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.`);
    window.currentLanguage = 'en'; // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π —è–∑—ã–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
    const toggleCompletedListButton = document.getElementById('toggleCompletedList');
    const completedList = document.getElementById('completedList');

    if (toggleCompletedListButton) {
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –Ω–∞ "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"
        toggleCompletedListButton.textContent = translations[window.currentLanguage].expand; 

        // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–ø–∏—Å–æ–∫ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç
        completedList.style.display = 'none';

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏
        toggleCompletedListButton.addEventListener('click', toggleCompletedList);
    } else {
        console.error('–ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.');
    }
});

function toggleCompletedList() {
    const completedList = document.getElementById('completedList');
    const toggleCompletedListButton = document.getElementById('toggleCompletedList');

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∏–¥–µ–Ω –ª–∏ —Å–ø–∏—Å–æ–∫
    const isVisible = completedList.style.display !== 'none';

    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Å–ø–∏—Å–∫–∞ –∏ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
    if (isVisible) {
        completedList.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫
        toggleCompletedListButton.textContent = translations[window.currentLanguage].expand; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å"
    } else {
        completedList.style.display = 'block'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫
        toggleCompletedListButton.textContent = translations[window.currentLanguage].collapse; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç "–°–≤–µ—Ä–Ω—É—Ç—å"
    }
}



</script>
</body>
</html>

